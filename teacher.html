<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>LDS ê´€ë¦¬ì</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2.0.0"></script>
  <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
  <style>
    /* ... (ìŠ¤íƒ€ì¼ì€ v76.5ì™€ ë™ì¼) ... */
    :root { --p: #4f46e5; --bg: #f1f5f9; --ok: #10b981; --fail: #ef4444; --cancel: #9ca3af; }
    body { font-family: 'Pretendard', sans-serif; background: var(--bg); padding: 20px; color:#333; margin:0; }
    
    .tabs { display: flex; gap: 10px; margin-bottom: 20px; flex-wrap: wrap; }
    .tab { padding: 12px 24px; border-radius: 10px; background: #cbd5e1; cursor: pointer; font-weight: bold; color: #475569; transition:0.2s; }
    .tab.active { background: var(--p); color: white; box-shadow: 0 4px 10px rgba(79, 70, 229, 0.3); }
    
    .view { display: none; } .view.active { display: block; animation: fadeIn 0.3s; }
    @keyframes fadeIn { from { opacity:0; transform:translateY(10px); } to { opacity:1; transform:translateY(0); } }
    
    input, textarea, select { width: 100%; padding: 10px; margin: 5px 0 15px; border: 1px solid #ddd; border-radius: 8px; box-sizing: border-box; }
    .btn { padding: 10px; width: 100%; border: none; border-radius: 8px; font-weight: bold; color: white; cursor: pointer; margin-top: 5px; }
    .btn-download { margin-top: 15px; width: 100%; background: #1e293b; color: white; padding: 12px; border-radius: 8px; border: none; font-weight: bold; cursor: pointer; font-size: 16px; }
    .mail-icon { position: absolute; top: 20px; right: 20px; font-size: 24px; cursor: pointer; background: white; padding: 8px; border-radius: 50%; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
    
    .daily-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 15px; }
    .student-col { background: white; padding: 15px; border-radius: 15px; box-shadow: 0 4px 10px rgba(0,0,0,0.05); }
    .col-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; border-bottom: 2px solid #f1f5f9; padding-bottom: 10px; }
    .student-name { font-size: 18px; font-weight: bold; margin: 0; }
    .money-badge { background: #fff7ed; color: #d97706; padding: 5px 10px; border-radius: 20px; font-weight: bold; font-size: 14px; }
    .qr-btn { font-size: 11px; background: #334155; color: white; border: none; padding: 4px 8px; border-radius: 4px; cursor: pointer; }

    .m-item { border: 1px solid #eee; padding: 10px; margin-bottom: 8px; border-radius: 8px; cursor: pointer; display: flex; justify-content: space-between; align-items: center; }
    .m-item.done { border-left: 5px solid var(--ok); background: #f0fdf4; }
    .m-item.life-ok { border-left: 5px solid var(--ok); background: #dcfce7; }
    .m-item.ing { border-left: 5px solid orange; background: #fff7ed; }
    .m-item.fail { border-left: 5px solid var(--fail); background: #fef2f2; opacity: 0.8; }
    .m-item.cancel { border-left: 5px solid var(--cancel); background: #f3f4f6; color: #6b7280; }
    .m-item.gong { border-left: 5px solid #8b5cf6; background: #f3e8ff; } 
    .cell-price { font-size: 11px; font-weight: 800; color: #059669; }

    .report-card { background: white; border-radius: 20px; padding: 25px; box-shadow: 0 4px 15px rgba(0,0,0,0.05); margin-bottom: 20px; position:relative; }
    .report-header { font-size: 20px; font-weight: 900; color: #1e293b; margin-bottom: 20px; border-bottom: 2px solid #f1f5f9; padding-bottom: 15px; display:flex; justify-content:space-between; }
    
    .report-page { border: 1px solid #e2e8f0; border-radius: 15px; padding: 30px; margin-bottom: 30px; background: #fff; page-break-after: always; box-shadow: 0 4px 15px rgba(0,0,0,0.05); }
    .page-title { font-size: 20px; font-weight: 800; color: var(--p); margin-bottom: 25px; display:block; border-left: 5px solid var(--p); padding-left: 15px; }

    .weekly-charts { display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 15px; margin-bottom: 20px; }
    .chart-box { background: #f8fafc; padding: 15px; border-radius: 12px; text-align: center; display:flex; flex-direction:column; align-items:center; }
    .chart-wrapper { width: 120px; height: 120px; position: relative; display: flex; justify-content: center; align-items: center; }
    .chart-value-text { font-size: 20px; font-weight: 900; color: #333; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); z-index: 10; }
    .chart-comment { font-size: 12px; color: #1e293b; margin-top: 10px; background: white; padding: 8px; border-radius: 8px; width: 100%; border: 1px solid #e2e8f0; font-weight: 600; line-height: 1.4; box-sizing: border-box; }

    .weekly-table, .monthly-table { width: 100%; border-collapse: collapse; margin-bottom: 20px; font-size: 13px; background: white; }
    .weekly-table th, .monthly-table th { background: #1e293b; color: white; padding: 10px; border-bottom: 2px solid #e2e8f0; }
    .weekly-table td, .monthly-table td { border: 1px solid #e2e8f0; padding: 8px; text-align: center; vertical-align: top; }
    
    .w-card { background: #fff; border: 1px solid #e2e8f0; border-radius: 8px; padding: 6px; margin-bottom: 6px; text-align: left; box-shadow: 0 1px 2px rgba(0,0,0,0.05); }
    .w-card-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 4px; }
    .w-name { font-weight: bold; font-size: 12px; color: #333; }
    .w-badge { font-size: 9px; font-weight: 800; padding: 2px 4px; border-radius: 4px; color: white; text-transform: uppercase; }
    .bg-easy { background: #10b981; } .bg-normal { background: #3b82f6; } .bg-hard { background: #ef4444; } .bg-gong { background: #8b5cf6; } .bg-none { background: #94a3b8; }
    .w-meta { font-size: 10px; color: #64748b; display: flex; justify-content: space-between; }
    .w-price { font-weight: bold; color: #059669; }

    .pay-statement { background: white; border: 2px solid #1e293b; border-radius: 10px; padding: 30px; text-align: center; position: relative; margin-top: 30px; }
    .pay-title { font-size: 24px; font-weight: bold; color: #1e293b; margin: 0; }
    .pay-big-total { font-size: 42px; font-weight: 900; color: var(--p); margin: 20px 0; }
    .pay-table-view, .salary-table { width: 100%; border-collapse: collapse; margin-top: 10px; }
    .pay-table-view th, .salary-table th { background: #f8fafc; padding: 10px; text-align: left; }
    .salary-table th { text-align: center; background: #e2e8f0; }
    .pay-table-view td, .salary-table td { padding: 12px 10px; border-bottom: 1px solid #e2e8f0; font-weight: 600; }
    .pay-table-view td.money-col { text-align: right; font-family: monospace; font-size: 16px; }
    .salary-table td { text-align: center; }

    .metric-row { display: flex; flex-direction: column; margin-bottom: 25px; background: #f8fafc; padding: 15px; border-radius: 12px; }
    .radar-container { width: 450px; height: 450px; margin: 0 auto; position: relative; }
    .stats-grid-3 { display:grid; grid-template-columns:1fr 1fr; gap:10px; }
    .score-box { background: white; border: 1px solid #e2e8f0; border-radius: 10px; padding: 15px; text-align: center; }
    .score-val { font-size: 18px; font-weight: 900; color: #333; margin-bottom: 5px; }

    .appearance-layout { background: white; border-radius: 20px; padding: 20px; box-shadow: 0 4px 15px rgba(0,0,0,0.05); }
    .calendar-container { margin-top: 20px; }
    .calendar-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; font-weight: bold; font-size: 18px; }
    .cal-nav-btn { background:none; border:none; font-size:18px; cursor:pointer; }
    .calendar-grid { display: grid; grid-template-columns: repeat(7, 1fr); gap: 5px; margin-top:10px; }
    .cal-day-name { text-align: center; padding: 5px; font-weight: bold; color: #64748b; background: #f1f5f9; border-radius: 5px; }
    .cal-cell { background: white; border: 1px solid #e2e8f0; border-radius: 5px; min-height: 100px; padding: 5px; display: flex; flex-direction: column; }
    .cal-img { width: 100%; height: 80px; object-fit: contain; margin-top: 5px; cursor: pointer; border: 1px solid #eee; border-radius: 4px; }
    
    #modal, #qrModal, #imgModal, #mailModal { position: fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.8); display:none; justify-content:center; align-items:center; z-index: 1000; }
    .modal-box { background: white; padding: 25px; border-radius: 15px; width: 400px; max-height: 90vh; overflow-y: auto; }
    #imgModalContent { max-width: 90%; max-height: 80vh; object-fit: contain; background: black; }
    .mail-item { background: #f8fafc; border: 1px solid #e2e8f0; padding: 10px; border-radius: 10px; margin-bottom: 8px; }
  </style>
</head>
<body>

<div class="tabs">
  <div class="tab active" id="tab-daily" onclick="goTab('daily')">ğŸ“… ì¼ê°„ ê´€ë¦¬</div>
  <div class="tab" id="tab-weekly" onclick="goTab('weekly')">ğŸ“Š ì£¼ê°„ ë¦¬í¬íŠ¸</div>
  <div class="tab" id="tab-monthly" onclick="goTab('monthly')">ğŸ† ì›”ê°„ ë¦¬í¬íŠ¸</div>
  <div class="tab" id="tab-appearance" onclick="goTab('appearance')">ğŸ‘” ìš©ëª¨ ê´€ë¦¬</div>
  <div class="tab" id="tab-notice" onclick="goTab('notice')">ğŸ“¢ ê³µì§€ì‚¬í•­</div>
</div>

<div class="mail-icon" onclick="openMailModal()">ğŸ“©</div>

<div id="daily" class="view active">
  <div style="margin-bottom: 15px;">
    <input type="date" id="dDate" style="width:auto; padding:8px;" onchange="loadDaily()">
    <button onclick="loadDaily()" style="background:var(--p); color:white; border:none; padding:8px 15px; border-radius:8px;">ìƒˆë¡œê³ ì¹¨</button>
  </div>
  <div class="daily-grid" id="dailyBoard"></div>
</div>

<div id="weekly" class="view">
  <div class="weekly-card" style="background:white; padding:20px; border-radius:20px;">
    <div style="display:flex; gap:10px; margin-bottom:15px;">
        <select id="wStudent" onchange="loadWeekly()" style="padding:10px; font-weight:bold;"><option value="S01">ê°•íƒœìœ¤</option><option value="S02">ê¹€ëŒ€ì¤‘</option><option value="S03">ìµœì›ì¤€</option></select>
        <select id="wWeekSelect" onchange="loadWeekly()" style="padding:10px; width:auto; border-radius:8px;"></select>
    </div>
    
    <div class="report-card" id="weeklyReportContainer" style="box-shadow:none; padding:0;">
      <div class="report-header">
        <span id="wReportTitle">ì£¼ê°„ ì„±ê³¼ ë¦¬í¬íŠ¸</span>
        <span style="font-size:14px; color:#666; font-weight:normal;" id="wDateRange">-</span>
      </div>
      <div class="weekly-charts">
        <div class="chart-box"><div class="chart-title">â‘  ìê¸° ê´€ë¦¬</div><div class="chart-wrapper"><canvas id="wcSelf"></canvas><div class="chart-value-text" id="wsSelf">-</div></div><div class="chart-comment" id="wsSelfMsg">...</div></div>
        <div class="chart-box"><div class="chart-title">â‘¡ ë„ì „ ì„±í–¥</div><div class="chart-wrapper"><canvas id="wcChal"></canvas><div class="chart-value-text" id="wsChal">-</div></div><div class="chart-comment" id="wsChalMsg">...</div></div>
        <div class="chart-box"><div class="chart-title">â‘¢ ìƒì‚°ì„±</div><div class="chart-wrapper" style="width:100%;"><canvas id="wcProd" style="height:80px;"></canvas><div class="chart-value-text" id="wsProd" style="display:none;"></div></div><div class="chart-comment" id="wsProdMsg">...</div></div>
        <div class="chart-box"><div class="chart-title">â‘£ ë§ˆê° ì¤€ìˆ˜</div><div class="chart-wrapper"><canvas id="wcComp"></canvas><div class="chart-value-text" id="wsComp">-</div></div><div class="chart-comment" id="wsCompMsg">...</div></div>
      </div>
      <div class="report-sub">ì£¼ê°„ ì—…ë¬´ ìˆ˜í–‰ ê¸°ë¡</div>
      <div style="overflow-x:auto;" id="weeklyBoard"></div>
      
      <div style="background:#f1f5f9; padding:15px; border-radius:10px; margin-top:10px; font-size:13px; color:#475569; text-align:right;">
          <span id="wSalaryDetail">...</span>
      </div>

      <div class="pay-statement">
          <div class="pay-logo">LIFE DESIGN STUDIO</div>
          <h2 class="pay-title" id="payStatementTitle">OOO ê¸‰ì—¬ ëª…ì„¸ì„œ</h2>
          <div class="pay-date-range" id="payDateRange">-</div>
          <div class="pay-big-total" id="payStatementTotal">â‚©0</div>
          <table class="pay-table-view"><thead><tr><th>í•­ëª© (ìš”ì¼)</th><th style="text-align:right;">ì§€ê¸‰ì•¡</th></tr></thead><tbody id="payTableBody"></tbody></table>
      </div>
    </div>
    <button class="btn-download" onclick="downloadWeeklyJPG()">ğŸ“¸ í†µí•© ë¦¬í¬íŠ¸ ì €ì¥ (JPG)</button>
  </div>
</div>

<div id="monthly" class="view">
  <div style="text-align: center; margin-bottom: 20px;">
    <select id="mStudent" onchange="loadMonthly()" style="padding:10px; font-weight:bold; width: auto; border-radius:8px;"><option value="S01">ê°•íƒœìœ¤</option><option value="S02">ê¹€ëŒ€ì¤‘</option><option value="S03">ìµœì›ì¤€</option></select>
    <input type="month" id="mMonth" onchange="loadMonthly()" style="padding:10px; border-radius:8px; border:1px solid #ddd; width:auto;">
  </div>
  
  <div id="monthlyReportContainer" style="background:none;">
      <div id="report-page-1" class="report-page">
          <div class="report-header"><span id="mReportTitle1">ì›”ê°„ ë¦¬í¬íŠ¸ (ì—­ëŸ‰ ìƒì„¸)</span></div>
          <span class="page-title">PART 1. 5ëŒ€ í•µì‹¬ ì—­ëŸ‰ ìƒì„¸ ë¶„ì„</span>
          
          <div class="weekly-charts">
            <div class="chart-box"><div class="chart-title">ìê¸° ê´€ë¦¬</div><div class="chart-wrapper"><canvas id="mcSelf"></canvas><div class="chart-value-text" id="msSelf">-</div></div><div class="chart-comment" id="msgSelf">ë¶„ì„ ì¤‘...</div></div>
            <div class="chart-box"><div class="chart-title">ë„ì „ ì„±í–¥</div><div class="chart-wrapper"><canvas id="mcChal"></canvas><div class="chart-value-text" id="msChal">-</div></div><div class="chart-comment" id="msgChal">ë¶„ì„ ì¤‘...</div></div>
            <div class="chart-box"><div class="chart-title">ì„±ì¥ ì§€í–¥</div><div class="chart-wrapper"><canvas id="mcGrow"></canvas><div class="chart-value-text" id="msGrow">-</div></div><div class="chart-comment" id="msgGrow">ë¶„ì„ ì¤‘...</div></div>
            <div class="chart-box"><div class="chart-title">ìƒì‚°ì„±</div><div class="chart-wrapper" style="width:100%;"><canvas id="mcProd" style="height:80px;"></canvas><div class="chart-value-text" id="msProd" style="display:none;"></div></div><div class="chart-comment" id="msgProd">ë¶„ì„ ì¤‘...</div></div>
            <div class="chart-box"><div class="chart-title">ë§ˆê° ì¤€ìˆ˜</div><div class="chart-wrapper"><canvas id="mcComp"></canvas><div class="chart-value-text" id="msComp">-</div></div><div class="chart-comment" id="msgComp">ë¶„ì„ ì¤‘...</div></div>
          </div>
          
          <span class="page-title" style="margin-top:40px;">PART 2. ìƒì„¸ í™œë™ ë‚´ì—­ (ëˆ„ì )</span>
          <table class="monthly-table"><thead><tr><th>í™œë™ëª…</th><th>1ì£¼</th><th>2ì£¼</th><th>3ì£¼</th><th>4ì£¼</th><th>5ì£¼</th><th>í•©ê³„</th></tr></thead><tbody id="mDetailBody"></tbody></table>
      </div>

      <div id="report-page-2" class="report-page">
          <div class="report-header"><span>ì›”ê°„ ë¦¬í¬íŠ¸ (ì¢…í•© ë¶„ì„)</span></div>
          
          <span class="page-title">PART 3. ì—­ëŸ‰ ë°¸ëŸ°ìŠ¤</span>
          <div class="radar-container"><canvas id="monthlyRadarChart"></canvas></div>
          
          <span class="page-title" style="margin-top:40px;">PART 4. ì£¼ì°¨ë³„ ê¸‰ì—¬ ì¶”ì´ (ë‹¨ìœ„: ì›)</span>
          <table class="salary-table" id="salaryTable"><thead><tr><th>êµ¬ë¶„</th><th>1ì£¼ì°¨</th><th>2ì£¼ì°¨</th><th>3ì£¼ì°¨</th><th>4ì£¼ì°¨</th><th>5ì£¼ì°¨</th></tr></thead><tbody></tbody></table>
          
          <div style="margin-top:20px; border-top:2px solid #eee; padding-top:15px; text-align:right;">
              <div style="font-size:16px; font-weight:bold; margin-bottom:5px;">ğŸ’° ì›”ê°„ ì´ ê¸‰ì—¬ í•©ê³„</div>
              <div style="font-size:36px; font-weight:900; color:var(--p);" id="mTotalIncome">â‚©0</div>
              <div style="font-size:12px; color:#666;">(ì „ì²´ í‰ê·  ëŒ€ë¹„ <span id="mProdText" style="font-weight:bold;">-</span>)</div>
          </div>
      </div>
  </div>
  <button class="btn-download" onclick="downloadMonthlyJPG()">ğŸ“¸ ì›”ê°„ ë¦¬í¬íŠ¸ ë‹¤ìš´ë¡œë“œ (JPG)</button>
</div>

<div id="appearance" class="view">
  <div class="appearance-layout">
    <div style="background:#f8fafc; padding:15px; border-radius:10px; margin-bottom:20px;">
      <h3 style="margin-top:0;">ğŸ“¸ ìš©ëª¨ ì²´í¬ ì—…ë¡œë“œ (ì „ìš© í´ë”)</h3>
      <select id="appStudent" onchange="loadAppearanceMonthly()"><option value="S01">ê°•íƒœìœ¤</option><option value="S02">ê¹€ëŒ€ì¤‘</option><option value="S03">ìµœì›ì¤€</option></select>
      <input type="date" id="appUploadDate" onchange="loadAppearanceMonthly()">
      <input type="file" id="appPhotoInput" accept="image/*">
      <button class="btn" style="background:var(--p);" onclick="uploadAppearancePhoto()">ì—…ë¡œë“œ ë° ì €ì¥</button>
    </div>
    <div class="calendar-container">
      <div class="calendar-header">
        <button class="cal-nav-btn" onclick="changeMonth(-1)">â—€</button>
        <span id="calMonthTitle"></span>
        <button class="cal-nav-btn" onclick="changeMonth(1)">â–¶</button>
      </div>
      <div class="calendar-grid" id="calendarGrid"></div>
    </div>
  </div>
</div>

<div id="notice" class="view">
  <div style="background:white; padding:20px; border-radius:20px; max-width:600px; margin:0 auto;">
    <h2 style="margin-top:0;">ğŸ“¢ ê³µì§€ì‚¬í•­ ë“±ë¡</h2>
    <textarea id="noticeInput" rows="5" placeholder="ê³µì§€í•  ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”..." style="width:100%; border:1px solid #ddd; padding:10px; border-radius:8px;"></textarea>
    <button onclick="saveNotice()" class="btn" style="background:var(--p); color:white;">ê³µì§€ ë“±ë¡í•˜ê¸°</button>
  </div>
</div>

<div id="modal"><div class="modal-box"><h3 id="mTitle" style="color:var(--p);"></h3><input type="hidden" id="mSid"><input type="hidden" id="mMid"><div id="ui-life" style="display:none;"><div class="chk-group"><label><input type="checkbox" class="life-chk"> 1. ê°œì¸ ìœ„ìƒ</label><label><input type="checkbox" class="life-chk"> 2. ì¹¨êµ¬ ì •ë¦¬</label></div><textarea id="lifeMsg" placeholder="ì½”ë©˜íŠ¸"></textarea><input type="file" id="lifePhoto"><button class="btn" style="background:var(--ok);" onclick="handleLife('life_ok')">ìŠ¹ì¸</button><button class="btn" style="background:var(--fail);" onclick="handleLife('fail')">ì‹¤íŒ¨</button></div><div id="ui-normal"><select id="ctrlMissionSelect"><option value="">(ìœ ì§€)</option><option value="í–‰ì‚¬">ğŸ‰ í–‰ì‚¬</option></select><div id="diffSection"><select id="tComment"><option value="NORMAL">NORMAL</option><option value="EASY">EASY</option><option value="HARD">HARD</option></select></div><button class="btn" style="background:var(--ok);" onclick="sendCtrl('end')">ì™„ë£Œ</button><button class="btn" style="background:#94a3b8;" onclick="sendCtrl('delete')">ì‚­ì œ</button><div style="margin-top:10px;border-top:1px solid #eee;padding-top:10px;"><button class="btn" style="background:#8b5cf6;" onclick="sendCtrl('gong')">âœ… ê³µê²° ì²˜ë¦¬</button></div></div><button class="btn" style="background:#eee;color:#333;" onclick="document.getElementById('modal').style.display='none'">ë‹«ê¸°</button></div></div>
<div id="imgModal"><div id="imgModalBox"><img id="imgModalContent" src=""><div style="display:flex; gap:10px;"><button class="img-modal-btn" onclick="downloadExpandedImg()">ğŸ’¾ ì €ì¥</button><button class="img-modal-btn" onclick="closeImgModal()">ë‹«ê¸°</button></div></div></div>
<div id="mailModal"><div class="modal-box" style="width:500px;"><h3 style="margin-top:0;">ğŸ“© LDS ì‹ ë¬¸ê³ </h3><div id="mailList" style="max-height:60vh; overflow-y:auto; text-align:left;"></div><button onclick="document.getElementById('mailModal').style.display='none'" class="btn" style="background:#eee; color:#333;">ë‹«ê¸°</button></div></div>
<div id="qrModal"><div id="qrCard"><h2>LDS EMPLOYEE</h2><div id="qrImage"></div><h3 id="qrName"></h3><button onclick="document.getElementById('qrModal').style.display='none'" class="btn" style="background:#eee;">ë‹«ê¸°</button></div></div>

<script>
// â–¼â–¼â–¼â–¼â–¼ ì„ ìƒë‹˜ì˜ ë°°í¬ URL ì…ë ¥ â–¼â–¼â–¼â–¼â–¼
const WEB_APP_URL = "https://script.google.com/macros/s/AKfycbyQmCpxD9AfGTGExe-Th4dw1Kr4lSZeSZ_6SserR1lt-D9ementbdlfF5tL3GIDzxOe2g/exec";
// â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²

const students = { "S01": "ê°•íƒœìœ¤", "S02": "ê¹€ëŒ€ì¤‘", "S03": "ìµœì›ì¤€" };
let weeklyCharts = {}; let monthlyCharts = {}; let radarChart = null; 
let currentCalDate = new Date(); let loadedMonthlyData = {}; 

Chart.register(ChartDataLabels);

document.addEventListener("DOMContentLoaded", () => {
  const offset = 1000 * 60 * 60 * 9; 
  const today = new Date(new Date().getTime() + offset);
  const todayStr = today.toISOString().slice(0,10);
  const monthStr = today.toISOString().slice(0,7);

  if(document.getElementById('dDate')) document.getElementById('dDate').value = todayStr;
  if(document.getElementById('appUploadDate')) document.getElementById('appUploadDate').value = todayStr;
  if(document.getElementById('mMonth')) document.getElementById('mMonth').value = monthStr;
  
  currentCalDate = new Date(todayStr);
  
  initWeekSelector(); 
  loadDaily(); 
  loadAppearanceMonthly();
  loadWeekly(); 
  loadMonthly();
});

function goTab(id) {
  document.querySelectorAll('.view').forEach(v => v.classList.remove('active'));
  document.getElementById(id).classList.add('active');
  document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
  if(id==='daily') document.getElementById('tab-daily').classList.add('active');
  if(id==='weekly') { document.getElementById('tab-weekly').classList.add('active'); loadWeekly(); }
  if(id==='monthly') { document.getElementById('tab-monthly').classList.add('active'); loadMonthly(); }
  if(id==='appearance') { document.getElementById('tab-appearance').classList.add('active'); loadAppearanceMonthly(); }
  if(id==='notice') document.getElementById('tab-notice').classList.add('active');
}

function saveNotice() { const txt=document.getElementById('noticeInput').value; if(!txt)return alert("ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”."); fetch(WEB_APP_URL,{method:"POST",body:JSON.stringify({action:"saveNotice",content:txt})}).then(()=>{alert("ê³µì§€ ë“±ë¡ ì™„ë£Œ"); document.getElementById('noticeInput').value="";}); }
function openMailModal() { document.getElementById('mailModal').style.display='flex'; document.getElementById('mailList').innerHTML="ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘..."; fetch(WEB_APP_URL,{method:"POST",body:JSON.stringify({action:"getSinmungoList"})}).then(r=>r.json()).then(res=>{ let h=""; if(!res.data||res.data.length===0) h="<div style='text-align:center;padding:20px;'>ì‹ ë¬¸ê³ ê°€ ì—†ìŠµë‹ˆë‹¤.</div>"; else res.data.forEach(m=>{ const d=new Date(m.date); h+=`<div class="mail-item"><div class="mail-date">${d.toLocaleDateString()}</div><div class="mail-title">${m.nick}</div><div class="mail-content">${m.content}</div></div>`; }); document.getElementById('mailList').innerHTML=h; }); }

// ì¼ê°„ ê´€ë¦¬
function loadDaily(){ 
  const date=document.getElementById('dDate').value; 
  fetch(WEB_APP_URL,{method:"POST",body:JSON.stringify({action:"getDailyData",date:date})}).then(res=>res.json()).then(data=>{ 
    const board=document.getElementById('dailyBoard'); board.innerHTML=""; 
    if(!data.logs) data.logs = {};

    Object.keys(students).forEach(sid=>{ 
      const col=document.createElement('div'); col.className='student-col'; 
      const l=data.logs[sid]||{}; 
      const s=(data.schedules && data.schedules[sid]) ? data.schedules[sid] : null;
      
      let currentTotal = 0; 
      if(l["ìƒí™œë¯¸ì…˜"] && l["ìƒí™œë¯¸ì…˜"].money) currentTotal += l["ìƒí™œë¯¸ì…˜"].money;
      Object.keys(l).forEach(k => { if(k!=="ìƒí™œë¯¸ì…˜" && k!=="í•˜ë£¨ ê¸°ë¡") currentTotal += (l[k].money||0); });

      col.innerHTML=`<div class="col-header"><h3 class="student-name">${students[sid]}</h3><span class="money-badge">â‚©${currentTotal.toLocaleString()}</span><button class="qr-btn" onclick="openQrModal('${sid}','${students[sid]}')">ğŸªª QR</button></div>`; 
      
      let lifeCls="", lifeTxt="ë¯¸ì™„ë£Œ";
      if(l["ìƒí™œë¯¸ì…˜"]){ if(l["ìƒí™œë¯¸ì…˜"].status==='life_ok'){lifeCls='life-ok';lifeTxt='ì„±ê³µ';} else if(l["ìƒí™œë¯¸ì…˜"].status==='fail'){lifeCls='fail';lifeTxt='ì‹¤íŒ¨';} }
      col.innerHTML+=`<div class="m-item ${lifeCls}" onclick="openModal('${sid}','ìƒí™œë¯¸ì…˜')"><b>ğŸŒ ìƒí™œë¯¸ì…˜</b> <span>${lifeTxt}</span></div>`; 
      
      if(s){ 
         const morning = ['m1','m2','m3'];
         const isMorningEvent = morning.every(k => s[k] && s[k].n === 'í–‰ì‚¬');
         let displayedEvents = new Set();

         ['m1','m2','m3','c1a','c1b','c2'].forEach(k => {
            if(!s[k] || !s[k].n) return;
            let mName = s[k].n;
            
            // ì˜¤ì „ í–‰ì‚¬ í†µí•© (1íšŒ ìˆ˜í–‰ 1íšŒ ì •ì‚°)
            if(isMorningEvent && morning.includes(k)) {
                if(!displayedEvents.has('morning_event')) {
                    let log = l['í–‰ì‚¬_ì˜¤ì „'] || l['í–‰ì‚¬'];
                    let c = ""; let priceHtml = "";
                    if(log) {
                        if(log.status=='end' || log.status=='ok') c='done'; 
                        if(log.money) priceHtml = ` <span class="cell-price">â‚©${log.money.toLocaleString()}</span>`;
                    }
                    col.innerHTML += `<div class="m-item ${c}" onclick="openModal('${sid}','í–‰ì‚¬')">ğŸ‰ ì˜¤ì „ í–‰ì‚¬ (í†µí•©) ${priceHtml}</div>`;
                    displayedEvents.add('morning_event');
                }
                return;
            }

            let displayName = mName;
            let logKey = mName;
            if(mName === 'í–‰ì‚¬') {
                if(k.startsWith('c1')) logKey = 'í–‰ì‚¬_ì„ íƒ';
                else if(k === 'c2') logKey = (s.day==='ëª©') ? 'í–‰ì‚¬_ëª©ì˜¤í›„' : 'í–‰ì‚¬_ì˜¤í›„';
                else if(morning.includes(k)) logKey = 'í–‰ì‚¬_ì˜¤ì „';
                displayName = `ğŸ‰ ${mName}`;
            }

            let log = l[logKey] || l[mName];
            let c = ""; let priceHtml = "";
            if(log) {
                if(log.status=='end' || log.status=='ok') c='done'; else if(log.status=='start') c='ing';
                else if(log.status=='gong') c='gong'; 
                if(log.money) priceHtml = ` <span class="cell-price">â‚©${log.money.toLocaleString()}</span>`;
            }
            col.innerHTML += `<div class="m-item ${c}" onclick="openModal('${sid}','${mName}')">${displayName} ${priceHtml}</div>`;
         });
      }
      board.appendChild(col); 
    }); 
  }); 
}

// ì£¼ê°„ ë¦¬í¬íŠ¸ (ìƒì„¸í™”)
function loadWeekly(){ 
  const sid = document.getElementById('wStudent').value; 
  const date = document.getElementById('wWeekSelect').value;
  if (!date) return;
  fetch(WEB_APP_URL,{method:"POST",body:JSON.stringify({action:"getWeeklyData",sid:sid,date:date})})
  .then(r=>r.json()).then(res=>{ 
    const s = res.scores || {self:0, challenge:0, productivity:0, completion:0}; 
    document.getElementById('wReportTitle').innerText = `${students[sid]}ì˜ ì£¼ê°„ ì„±ê³¼ ë¦¬í¬íŠ¸`;
    
    drawWeeklyCharts(s);
    
    // ìƒì„¸ ê¸‰ì—¬ í…ìŠ¤íŠ¸
    const bd = res.breakdown || {missionCount:0, missionMoney:0, lifeCount:0, lifeMoney:0};
    document.getElementById('wSalaryDetail').innerText = `ì„±ê³µ ${bd.missionCount}ê±´(${bd.missionMoney.toLocaleString()}) + ìƒí™œ ${bd.lifeCount}ê±´(${bd.lifeMoney.toLocaleString()}) = ì´ â‚©${res.total.toLocaleString()}`;

    let h=`<table class="weekly-table"><thead><tr><th>ì‹œê°„</th>`; ["ì›”","í™”","ìˆ˜","ëª©","ê¸ˆ"].forEach(d=>h+=`<th>${d}</th>`); h+=`</tr></thead><tbody>`; 
    const slots=[{t:"09:00",k:"life"},{t:"09:30",k:"am"},{t:"11:00",k:"sel1"},{t:"13:00",k:"pm"}]; 
    slots.forEach(slot=>{ 
      h+=`<tr><td>${slot.t}</td>`; 
      for(let i=0;i<5;i++){ 
        const d=res.days[i].data; const sched=d.schedules[sid]; const l=d.logs[sid]||{}; let content=""; 
        if(slot.k==='life'){ content="ìƒí™œë¯¸ì…˜"; if(l["ìƒí™œë¯¸ì…˜"]){ if(l["ìƒí™œë¯¸ì…˜"].status==='life_ok')content+="<br>âœ…"; if(l["ìƒí™œë¯¸ì…˜"].money) content+=`<br>â‚©${l["ìƒí™œë¯¸ì…˜"].money.toLocaleString()}`; } } 
        else if(sched) {
            let keys = slot.k==='am'?['m1','m2','m3']: (slot.k==='sel1'?['c1a','c1b']:['c2']);
            let items = [];
            keys.forEach(k=>{ 
                if(sched[k]) {
                    let mName = sched[k].n;
                    let logKey = mName;
                    if(mName === 'í–‰ì‚¬') {
                        if(keys.includes('m1')) logKey = 'í–‰ì‚¬_ì˜¤ì „';
                        else if(keys.includes('c1a')) logKey = 'í–‰ì‚¬_ì„ íƒ';
                        else logKey = 'í–‰ì‚¬_ì˜¤í›„';
                    }
                    let log = l[logKey] || l[mName];
                    let badge = "";
                    if(log) {
                        if(log.status==='gong') badge = `<span class="w-badge bg-gong">ê³µê²°</span>`;
                        else if(log.message) {
                            let diff = log.message.toUpperCase();
                            let bgClass = diff==='HARD'?'bg-hard':(diff==='EASY'?'bg-easy':'bg-normal');
                            badge = `<span class="w-badge ${bgClass}">${diff.charAt(0)}</span>`;
                        }
                    } else {
                        badge = `<span class="w-badge bg-none">-</span>`;
                    }
                    
                    let timeStr = "";
                    if(log && log.note && log.note.includes("ë¶„")) {
                        if(log.note.includes("ì†Œìš”")) timeStr = `<span style="font-size:9px;color:#666;">${log.note}</span>`;
                    }

                    items.push(`
                        <div class="w-card">
                            <div class="w-card-header"><span class="w-name">${mName}</span>${badge}</div>
                            <div class="w-meta">
                                ${timeStr}
                                ${log&&log.money?`<span class="w-price">â‚©${log.money.toLocaleString()}</span>`:''}
                            </div>
                        </div>
                    `);
                }
            });
            content = items.join("");
        }
        h+=`<td>${content}</td>`; 
      } h+=`</tr>`; 
    }); 
    h+=`<tr><td style="font-weight:bold;">í•©ê³„</td>`; for(let i=0;i<5;i++)h+=`<td style="font-weight:bold; color:var(--p);">â‚©${res.days[i].money.toLocaleString()}</td>`; h+=`</tr></tbody></table>`; 
    document.getElementById('weeklyBoard').innerHTML=h; 
    
    document.getElementById('payStatementTitle').innerText = `${students[sid]} ê¸‰ì—¬ ëª…ì„¸ì„œ`;
    document.getElementById('payStatementTotal').innerText = "â‚©" + res.total.toLocaleString();
    const tbody = document.getElementById('payTableBody'); tbody.innerHTML=""; 
    const dayNames=["ì›”ìš”ì¼","í™”ìš”ì¼","ìˆ˜ìš”ì¼","ëª©ìš”ì¼","ê¸ˆìš”ì¼"]; 
    for(let i=0;i<5;i++){ const tr=document.createElement('tr'); tr.innerHTML=`<td>${dayNames[i]}</td><td class="money-col">â‚©${res.days[i].money.toLocaleString()}</td>`; tbody.appendChild(tr); } 
  }); 
}

// ì›”ê°„ ë¦¬í¬íŠ¸
function loadMonthly() {
    const sid = document.getElementById('mStudent').value;
    const month = document.getElementById('mMonth').value;
    if(!month) return;
    fetch(WEB_APP_URL, { method: "POST", body: JSON.stringify({ action: "getMonthlyData", sid, month }) })
    .then(r => r.json()).then(res => {
        const s = res.myScores || {self:0, challenge:0, growth:0, productivity:0, completion:0};
        const c = res.counts || {};
        
        drawMonthlyCharts(s);
        
        document.getElementById('msgSelf').innerText = `ì´ ${c.life.total}íšŒ ì¤‘ ${c.life.success}íšŒ ì„±ê³µ (${s.self}%)`;
        document.getElementById('msgChal').innerText = `í‰ê·  ë‚œì´ë„ ${s.challenge}ì \n(E:${c.chal.easy} / N:${c.chal.normal} / H:${c.chal.hard})`;
        document.getElementById('msgGrow').innerText = `í‰ê·  ì´ìƒ ë‚œì´ë„ ì„ íƒ: ${c.grow.high}íšŒ (${s.growth}%)`;
        document.getElementById('msgProd').innerText = s.productivity >= 0 ? `í‰ê·  ëŒ€ë¹„ +${s.productivity}% ë‹¬ì„±` : `í‰ê·  ëŒ€ë¹„ ${s.productivity}% (ì €ì¡°)`;
        document.getElementById('msgComp').innerText = `ì‹œê°„ ë‚´ ì™„ë£Œ ${c.comp.success}ê±´ / ì „ì²´ ${c.comp.total}ê±´ (${s.completion}%)`;

        const tSalary = document.getElementById('salaryTable').querySelector('tbody'); tSalary.innerHTML = "";
        let salRow = `<td>ê¸‰ì—¬</td>`;
        for(let w=1; w<=5; w++) {
            let inc = (res.weeklyStats && res.weeklyStats[w]) ? res.weeklyStats[w].income : 0;
            salRow += `<td>â‚©${inc.toLocaleString()}</td>`;
        }
        tSalary.innerHTML = `<tr>${salRow}</tr>`;

        document.getElementById('mTotalIncome').innerText = "â‚©" + (res.financials.myTotal||0).toLocaleString();
        let diff = (res.financials.myTotal||0) - (res.financials.allTotalAvg||0);
        document.getElementById('mProdText').innerText = (diff>=0 ? "+" : "") + "â‚©" + diff.toLocaleString();
        
        drawRadar(s, res.globalScores);
        
        const tbody = document.getElementById('mDetailBody'); tbody.innerHTML = "";
        ["ìƒí™œë¯¸ì…˜", "ë…ì„œ", "ê¸€ì“°ê¸°", "ìì„œì „", "ìš´ë™", "ì˜ì–´íšŒí™”", "ê²€ì •ê³ ì‹œ", "í–‰ì‚¬"].forEach(m => {
            let row = `<td>${m}</td>`; let sum=0;
            for(let w=1; w<=5; w++) {
                const d = res.weeklyDetails[w][m] || {count:0, money:0};
                row += `<td>${d.count}íšŒ</td>`; sum += d.money;
            }
            row += `<td style="font-weight:bold;">â‚©${sum.toLocaleString()}</td>`;
            tbody.innerHTML += `<tr>${row}</tr>`;
        });
    });
}

function drawWeeklyCharts(s) { drawCommonCharts('w', s); }
function drawMonthlyCharts(s) { drawCommonCharts('m', s); }

function drawCommonCharts(pf, s) {
  const drawDoughnut = (id, val, color) => {
      const ctx = document.getElementById(id).getContext('2d');
      if(weeklyCharts[id]) weeklyCharts[id].destroy();
      weeklyCharts[id] = new Chart(ctx, { 
          type: 'doughnut', 
          data: { datasets: [{ data: [Math.max(1, val), 100-val], backgroundColor: [val>0?color:'#e2e8f0','#e2e8f0'] }] }, 
          options: { cutout: '70%', plugins: { legend: false, datalabels: false } } 
      });
  };
  
  drawDoughnut(pf+'cSelf', s.self, '#10b981'); document.getElementById(pf+'sSelf').innerText = s.self + "%";
  drawDoughnut(pf+'cChal', (s.challenge-1)*50, '#f59e0b'); document.getElementById(pf+'sChal').innerText = s.challenge;
  
  const ctxProd = document.getElementById(pf+'cProd').getContext('2d');
  if(weeklyCharts[pf+'prod']) weeklyCharts[pf+'prod'].destroy();
  weeklyCharts[pf+'prod'] = new Chart(ctxProd, { 
      type: 'bar', 
      data: { labels: [''], datasets: [{ label: 'í‰ê·  ëŒ€ë¹„', data: [s.productivity], backgroundColor: s.productivity>=0?'#4f46e5':'#ef4444', barThickness: 20 }] }, 
      options: { indexAxis: 'y', scales: { x: { min: -50, max: 50, grid:{display:true} }, y: { display: false } }, plugins: { legend: false, datalabels: false } } 
  });
  if(document.getElementById(pf+'sProd')) document.getElementById(pf+'sProd').innerText = (s.productivity>0?"+":"") + s.productivity + "%";

  drawDoughnut(pf+'cComp', s.completion, '#ef4444'); document.getElementById(pf+'sComp').innerText = s.completion + "%";

  if(pf === 'm') {
      drawDoughnut('mcGrow', s.growth, '#8b5cf6'); document.getElementById('msGrow').innerText = s.growth + "%";
  }
}

function drawRadar(s, g) {
    const ctxRadar = document.getElementById('monthlyRadarChart').getContext('2d');
    if(radarChart) radarChart.destroy();
    
    const normChal = Math.max(0, Math.min(100, (s.challenge - 1) * 50));
    const normProd = Math.max(0, Math.min(100, (s.productivity/2) + 50));

    radarChart = new Chart(ctxRadar, {
        type: 'radar',
        data: {
            labels: ['ìê¸°ê´€ë¦¬', 'ë„ì „ì„±í–¥', 'ì„±ì¥ì§€í–¥', 'ìƒì‚°ì„±', 'ë§ˆê°ì¤€ìˆ˜'],
            datasets: [{
                label: 'ë‚˜ì˜ ì—­ëŸ‰',
                data: [s.self, normChal, s.growth, normProd, s.completion],
                backgroundColor: 'rgba(79, 70, 229, 0.2)',
                borderColor: '#4f46e5',
                borderWidth: 2,
                pointBackgroundColor: '#4f46e5'
            }]
        },
        options: { scales: { r: { min: 0, max: 100, ticks: { display: false } } } }
    });
}

function uploadAppearancePhoto() {
    const file = document.getElementById('appPhotoInput').files[0];
    const date = document.getElementById('appUploadDate').value;
    const sid = document.getElementById('appStudent').value;
    if(!file || !date) return alert("ë‚ ì§œì™€ ì‚¬ì§„ì„ í™•ì¸í•´ì£¼ì„¸ìš”.");
    
    const reader = new FileReader();
    reader.readAsDataURL(file);
    reader.onload = function(e) {
        const base64 = e.target.result.split(',')[1];
        const sText = document.getElementById('appStudent').selectedOptions[0].text;
        fetch(WEB_APP_URL, { method:"POST", body:JSON.stringify({
            action:"uploadAppearance", base64:base64, mimeType:file.type, sid:sid, name:sText, date:date
        })}).then(r=>r.json()).then(res => {
            alert("ì—…ë¡œë“œ ì™„ë£Œ!"); loadAppearanceMonthly();
        });
    }
}
function loadAppearanceMonthly() {
    const sid = document.getElementById('appStudent').value;
    fetch(WEB_APP_URL, { method:"POST", body:JSON.stringify({action:"getAppearanceData", mode:"monthly", sid:sid}) }).then(r=>r.json()).then(res => {
        loadedMonthlyData = {}; 
        if(res.data && res.data.monthly) { res.data.monthly.forEach(item => { loadedMonthlyData[item.date] = item.url; }); }
        renderCalendar();
    });
}
function renderCalendar() { 
    const year = currentCalDate.getFullYear(); const month = currentCalDate.getMonth(); 
    document.getElementById('calMonthTitle').innerText = `${year}ë…„ ${month+1}ì›”`; 
    const firstDay = new Date(year, month, 1); const lastDay = new Date(year, month+1, 0); 
    let html = ""; 
    const days = ["ì¼","ì›”","í™”","ìˆ˜","ëª©","ê¸ˆ","í† "]; days.forEach(d => html += `<div class="cal-day-name">${d}</div>`); 
    for(let i=0; i<firstDay.getDay(); i++) html += `<div></div>`; 
    for(let i=1; i<=lastDay.getDate(); i++) { 
        const ymd = `${year}-${String(month+1).padStart(2,'0')}-${String(i).padStart(2,'0')}`;
        const url = loadedMonthlyData[ymd];
        html += `<div class="cal-cell"><div class="cal-date">${i}</div>${url ? `<img src="${url}" class="cal-img" onclick="openImageModal(this.src)">` : ''}</div>`;
    }
    document.getElementById('calendarGrid').innerHTML = html;
}
function changeMonth(offset) { currentCalDate.setMonth(currentCalDate.getMonth() + offset); loadAppearanceMonthly(); }
function openImageModal(src) { document.getElementById('imgModal').style.display = 'flex'; document.getElementById('imgModalContent').src = src; }
function closeImgModal() { document.getElementById('imgModal').style.display = 'none'; }
function downloadExpandedImg() { 
    const link = document.createElement('a'); link.href = document.getElementById('imgModalContent').src; 
    link.download = `LDS_Photo_${Date.now()}.jpg`; link.click(); 
}

function initWeekSelector() { 
    const wSel = document.getElementById('wWeekSelect');
    const today = new Date();
    for (let i = 0; i < 5; i++) { 
        const d = new Date(today); d.setDate(today.getDate() - (i * 7)); 
        const diff = d.getDate() - d.getDay() + (d.getDay() == 0 ? -6 : 1); 
        const monday = new Date(d.setDate(diff)); const val = monday.toISOString().slice(0,10); 
        const opt = document.createElement('option'); opt.value=val; opt.innerText=`${monday.getMonth()+1}ì›” ${Math.ceil(monday.getDate()/7)}ì£¼ì°¨ (${val}~)`; 
        wSel.appendChild(opt); 
    } 
}
function openQrModal(sid, name) { document.getElementById('qrModal').style.display = 'flex'; document.getElementById('qrName').innerText = name; document.getElementById('qrImage').innerHTML = `<img src="https://quickchart.io/qr?text=${encodeURIComponent(sid+","+name)}&size=200">`; }
function downloadMonthlyJPG() { html2canvas(document.getElementById('monthlyReportContainer')).then(c => { const a = document.createElement('a'); a.download='MonthReport.jpg'; a.href=c.toDataURL(); a.click(); }); }
function downloadWeeklyJPG() { html2canvas(document.getElementById('weeklyReportContainer')).then(c => { const a = document.createElement('a'); a.download='WeekReport.jpg'; a.href=c.toDataURL(); a.click(); }); }
function openModal(sid,mid){ document.getElementById('modal').style.display='flex'; document.getElementById('mTitle').innerText=mid; document.getElementById('mSid').value=sid; document.getElementById('mMid').value=mid; if(mid==='ìƒí™œë¯¸ì…˜') { document.getElementById('ui-life').style.display='block'; document.getElementById('ui-normal').style.display='none'; } else { document.getElementById('ui-life').style.display='none'; document.getElementById('ui-normal').style.display='block'; } }
function handleLife(s){ const f=document.getElementById('lifePhoto').files[0]; const msg=document.getElementById('lifeMsg').value; if(f){ const r=new FileReader(); r.readAsDataURL(f); r.onload=function(e){ sendData(s, msg, e.target.result.split(',')[1], f.type); } } else { sendData(s, msg, null, null); } }
function sendData(s, msg, b64, mime) { 
    const sid=document.getElementById('mSid').value; const d=document.getElementById('dDate').value; 
    const body = { action: b64?"uploadLifePhoto":"teacherControl", sid:sid, mid:"ìƒí™œë¯¸ì…˜", act:s, message:msg, date:d };
    if(b64) { body.base64=b64; body.mimeType=mime; body.name=document.getElementById('appStudent').selectedOptions[0].text; }
    fetch(WEB_APP_URL,{method:"POST",body:JSON.stringify(body)}).then(()=>{alert("ì™„ë£Œ"); document.getElementById('modal').style.display='none'; loadDaily();});
}
function sendCtrl(act){ const sid=document.getElementById('mSid').value; const mid=document.getElementById('mMid').value; const d=document.getElementById('dDate').value; fetch(WEB_APP_URL,{method:"POST",body:JSON.stringify({action:"teacherControl", sid:sid, mid:mid, act:act, date:d})}).then(()=>{alert("ì²˜ë¦¬ë¨"); document.getElementById('modal').style.display='none'; loadDaily();}); }
</script>
</body>
</html>